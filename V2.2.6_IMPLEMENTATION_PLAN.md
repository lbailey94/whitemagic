# WhiteMagic v2.2.6 Implementation Plan

**Version**: 2.2.6  
**Timeline**: 1-2 weeks  
**Date**: November 16, 2025

---

## ðŸŽ¯ Goals

Based on GPT-5.1 Codex and GPT-5 High Reasoning feedback:

1. **CLI Metrics** - `whitemagic metrics track/summary/export`
2. **React Dashboard** - Visual metrics + Wu Xing wheel
3. **Symbolic Cookbook** - Practical examples + visualization
4. **Enhanced Loader** - Better heuristics, caching
5. **Security Tests** - Terminal tool regression tests
6. **Test Fixes** - Clean up 4 failing edge cases

---

## ðŸ“‹ Phase 1: CLI Metrics (3 hours)

### Commands to Add

```bash
whitemagic metrics track --category token_efficiency --metric usage --value 42.5
whitemagic metrics summary [--json] [--categories ...]
whitemagic metrics export --format csv --output metrics.csv
```

**Files**:
- `whitemagic/cli_app.py` - Add 3 command handlers (~120 lines)
- `tests/test_cli_metrics.py` - New test file

---

## ðŸ“Š Phase 2: React Dashboard (5 hours)

### Structure
```
dashboard-v2/
â”œâ”€â”€ pages/index.tsx          # Main dashboard
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WuXingWheel.tsx      # Five-phase diagram
â”‚   â”œâ”€â”€ MetricsChart.tsx     # Token efficiency
â”‚   â””â”€â”€ ConceptGraph.tsx     # Symbolic viz
â””â”€â”€ lib/whitemagic.ts        # API client
```

**Tech**: Next.js + Recharts + TailwindCSS

---

## ðŸ“š Phase 3: Symbolic Cookbook (3 hours)

**File**: `docs/guides/SYMBOLIC_REASONING_COOKBOOK.md`

**Recipes**:
1. Chinese compression basics
2. Building concept maps
3. Memory-concept linking
4. Token efficiency measurement
5. Graph visualization

**Plus**: Jupyter notebook examples

---

## âš¡ Phase 4: Enhanced Loader (3 hours)

### Improvements

1. **Focus keyword weighting** - Prioritize relevant directories
2. **Directory stats caching** - 3-5x speedup
3. **Tier-aware max depth** - Tier 0: 2, Tier 1: 3, Tier 2: 5
4. **Parallel scanning** - ThreadPoolExecutor for I/O

**Files**: `whitemagic/workspace_loader.py`

---

## ðŸ”’ Phase 5: Security Tests (2 hours)

**File**: `tests/test_terminal_security.py`

**Coverage**:
- Blocklist enforcement (dangerous commands)
- Allowlist validation (safe commands)
- Audit log completeness
- Write approval workflow

**Doc**: `docs/guides/TERMINAL_TOOL_SECURITY.md`

---

## ðŸ§ª Phase 6: Fix Test Failures (2 hours)

1. API search endpoint (422 error) - Schema fix
2. MCP wrapper timeout - Increase timeout
3. Consolidation auto-promote - Review logic
4. Workspace exclusion - Fix pattern matching

**Target**: 198/198 tests passing

---

## ðŸ”§ Phase 7: Extras (2 hours)

- Increase parallel calls: 8 â†’ 16
- Add MCP tools: `find_similar_problem`, `scratchpad`
- Markdownlint CI integration

---

## ðŸ“… Implementation Timeline

**Week 1** (Parallel execution):
- Stream A: Phases 1, 5, 6 (CLI + Security + Tests)
- Stream B: Phases 3, 4 (Cookbook + Loader)

**Week 2**:
- Phase 2: Dashboard (focused work)
- Phase 7: Extras
- Documentation + validation

**Total**: 20-25 hours over 7-10 days

---

## âœ… Success Criteria

- All CLI metrics commands functional
- Dashboard displays metrics + Wu Xing
- 5+ cookbook recipes with examples
- Smart loader 20%+ faster
- All 198 tests passing
- Security coverage complete

**Token Budget**: 80-120K tokens
