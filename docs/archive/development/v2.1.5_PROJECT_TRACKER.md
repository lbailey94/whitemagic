# v2.2.1 Project Tracker

**Start Date**: November 13, 2025  
**Target Ship**: December 20, 2025  
**Branch**: `v2.2.1-dev`  
**Status**: ðŸ“‹ **PLANNING**  
**Theme**: "Monetization Foundation"

---

## ðŸŽ¯ Goals

Transform WhiteMagic from developer tool to revenue-generating product by:
1. **Visibility**: Users see and understand their usage
2. **Value**: Clear feature differentiation by plan
3. **Conversion**: Smooth path from free â†’ paid
4. **Retention**: Proactive alerts prevent churn

---

## ðŸ“‹ Features

### Must-Have (MVP)

| # | Feature | Priority | Status | Effort | Owner |
|---|---------|----------|--------|--------|-------|
| **#3.1** | Basic Usage Dashboard | P0 | ðŸ“‹ TODO | 1-2 days | TBD |
| **#3.2** | Usage API Endpoint | P0 | ðŸ“‹ TODO | 0.5 days | TBD |
| **#3.3** | Plan Display from Whop | P0 | ðŸ“‹ TODO | 0.5 days | TBD |

**Total MVP**: 2-3 days

### Should-Have

| # | Feature | Priority | Status | Effort | Owner |
|---|---------|----------|--------|--------|-------|
| **#4** | Tiered Feature Toggles | P1 | ðŸ“‹ TODO | 1 week | TBD |
| **#5** | Usage Alerts (80% threshold) | P1 | ðŸ“‹ TODO | 0.5 weeks | TBD |
| **#6** | Whop Webhook Integration | P1 | ðŸ“‹ TODO | 0.5 weeks | TBD |

**Total Should-Have**: 2 weeks

### Nice-to-Have

| # | Feature | Priority | Status | Effort | Owner |
|---|---------|----------|--------|--------|-------|
| **#7** | Advanced Analytics | P2 | ðŸ“‹ TODO | 1 week | TBD |
| **#8** | Usage Export (CSV) | P2 | ðŸ“‹ TODO | 0.5 days | TBD |
| **#9** | Custom Alert Thresholds | P2 | ðŸ“‹ TODO | 0.5 days | TBD |

---

## ðŸš€ Feature #3.1: Basic Usage Dashboard

### Scope
**Page**: `/dashboard/account` or `/dashboard/usage`

**Display**:
- Current plan name (from Whop)
- Memory count (short-term, long-term, archived)
- Storage used (MB / quota)
- API calls today (RPM tracking)
- Simple 7-day usage chart

**Design**:
- Mobile responsive
- Clean, modern UI
- Clear upgrade CTA if on free plan
- "Last updated" timestamp

### Technical
```python
# Backend: New endpoint
GET /api/v1/users/me/usage
Response:
{
  "plan": {
    "name": "Free",
    "tier": "free",
    "limits": {
      "memories": 100,
      "storage_mb": 50,
      "rpm": 10
    }
  },
  "usage": {
    "memories": {
      "short_term": 12,
      "long_term": 5,
      "archived": 2,
      "total": 19
    },
    "storage_mb": 3.2,
    "api_calls_today": 47,
    "api_calls_7d": [12, 15, 20, 18, 22, 19, 47]  # Last 7 days
  },
  "quotas": {
    "memories_percent": 19,
    "storage_percent": 6.4,
    "rpm_current": 3
  }
}
```

```html
<!-- Frontend: dashboard/account.html -->
<div class="usage-dashboard">
  <h1>Your Usage</h1>
  
  <!-- Plan Card -->
  <div class="plan-card">
    <h2>Free Plan</h2>
    <p>19 / 100 memories</p>
    <p>3.2 MB / 50 MB storage</p>
    <button>Upgrade to Pro</button>
  </div>
  
  <!-- Usage Chart -->
  <div class="usage-chart">
    <h3>API Calls (Last 7 Days)</h3>
    <canvas id="usageChart"></canvas>
  </div>
  
  <!-- Quota Meters -->
  <div class="quota-meters">
    <div class="meter">
      <label>Memories</label>
      <div class="progress-bar">
        <div class="progress" style="width: 19%"></div>
      </div>
      <span>19%</span>
    </div>
    <!-- Similar for storage, RPM -->
  </div>
</div>
```

### Acceptance Criteria
- [ ] Dashboard loads in < 2 seconds
- [ ] All metrics display correctly
- [ ] Chart renders with real data
- [ ] Upgrade CTA links to Whop portal
- [ ] Mobile responsive (breakpoint: 768px)
- [ ] No console errors
- [ ] Handles API errors gracefully

---

## ðŸš€ Feature #4: Tiered Feature Toggles

### Scope
**Backend enforcement** of plan-based feature access

```python
# whitemagic/features.py
PLAN_FEATURES = {
    "free": [
        "basic_memory",  # CRUD operations
        "search",        # Basic text search
    ],
    "starter": [
        "basic_memory",
        "search",
        "semantic_search",  # Embedding-based search
        "tags",            # Tag management
    ],
    "pro": [
        "basic_memory",
        "search",
        "semantic_search",
        "tags",
        "exec_api",        # Terminal execution
        "webhooks",        # Webhook notifications
        "exports",         # CSV/JSON exports
    ],
    "enterprise": ["all"]
}

def check_feature(user, feature_name):
    """Check if user's plan includes feature"""
    plan = user.plan_tier  # from Whop metadata
    if plan == "enterprise":
        return True
    return feature_name in PLAN_FEATURES.get(plan, [])
```

### Integration Points
- Middleware: Check before protected endpoints
- Frontend: Show/hide features based on plan
- Graceful degradation: Show upgrade prompt instead of 403

### Example
```python
# In route handler
@router.post("/api/v1/exec/write")
async def exec_write(user: CurrentUser):
    if not check_feature(user, "exec_api"):
        raise UpgradeRequired(
            message="Terminal execution requires Pro plan",
            upgrade_url="/dashboard/upgrade"
        )
    # ... proceed with exec
```

---

## ðŸš€ Feature #5: Usage Alerts

### Scope
Email + webhook notifications when hitting thresholds

**Triggers**:
- 80% of memory quota
- 80% of storage quota
- 90% of daily RPM limit
- Plan expiration (7 days before)

**Channels**:
- Email (via SendGrid/similar)
- Webhook (POST to user-configured URL)
- Dashboard notification badge

### Implementation
```python
# whitemagic/alerts.py
async def check_quotas(user_id: str):
    """Background task: Check if user needs alerts"""
    usage = await get_user_usage(user_id)
    
    if usage.memories_percent >= 80:
        await send_alert(
            user_id,
            type="quota_warning",
            resource="memories",
            percent=usage.memories_percent,
            message="You're using 80% of your memory quota"
        )
    
    # Similar for storage, RPM
```

**Frequency**: Check every hour, send max 1 alert/day per resource

---

## ðŸš€ Feature #6: Whop Integration

### Scope
Sync plan data from Whop, handle plan changes via webhooks

**Endpoints**:
```
POST /api/webhooks/whop  # Webhook handler
GET /api/v1/users/me/billing  # Billing portal link
```

**Whop Events**:
- `membership.created` - New subscription
- `membership.updated` - Plan upgrade/downgrade
- `membership.cancelled` - Cancellation
- `membership.renewed` - Renewal

**Implementation**:
```python
@router.post("/api/webhooks/whop")
async def whop_webhook(request: Request):
    """Handle Whop webhook events"""
    payload = await request.json()
    event_type = payload["type"]
    
    if event_type == "membership.updated":
        user_id = payload["data"]["user_id"]
        new_plan = payload["data"]["plan_name"]
        await update_user_plan(user_id, new_plan)
        await clear_feature_cache(user_id)
    
    return {"status": "ok"}
```

---

## ðŸ“… Timeline

### Week 1 (Nov 13-17)
**Focus**: Dashboard MVP

- [ ] Day 1-2: Backend usage endpoint
- [ ] Day 3-4: Frontend dashboard page
- [ ] Day 5: Testing & polish

**Deliverable**: Working dashboard showing usage

---

### Week 2 (Nov 18-22)
**Focus**: Feature Toggles & Alerts

- [ ] Day 1-2: Feature toggle system
- [ ] Day 3: Middleware integration
- [ ] Day 4-5: Usage alerts implementation

**Deliverable**: Plan-based feature access working

---

### Week 3 (Nov 25-29)
**Focus**: Whop Integration & Polish

- [ ] Day 1-2: Whop webhook handlers
- [ ] Day 3: Billing portal integration
- [ ] Day 4: Full integration testing
- [ ] Day 5: **Thanksgiving** (light work)

**Deliverable**: End-to-end monetization flow

---

### Week 4 (Dec 2-6)
**Focus**: Testing & Ship Prep

- [ ] Day 1: Bug fixes
- [ ] Day 2: Documentation
- [ ] Day 3: Final testing
- [ ] Day 4: Release prep
- [ ] Day 5: Buffer day

**Deliverable**: v2.2.1 ready to ship

---

### Week 5 (Dec 9-13)
**Focus**: Ship & Monitor

- [ ] Mon: Final review
- [ ] Tue: Tag & release v2.2.1
- [ ] Wed-Fri: Monitor, gather feedback

**Ship Date**: December 10, 2025 (target)

---

## ðŸŽ¯ Success Metrics

### Usage Dashboard
- [ ] 80%+ active users view dashboard in first week
- [ ] Average session time > 2 minutes
- [ ] < 5% error rate on dashboard loads

### Monetization
- [ ] Free â†’ Paid conversion baseline established
- [ ] First paid conversion within 2 weeks
- [ ] Average Revenue Per User (ARPU) tracked

### Technical
- [ ] All features behind feature flags
- [ ] Whop webhook processing < 500ms
- [ ] Alert emails sent within 5 minutes

---

## ðŸ›¡ï¸ Risks & Mitigation

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Whop API changes | Low | High | Version API calls, monitor docs |
| Dashboard performance | Medium | Medium | Cache usage data, optimize queries |
| Email deliverability | Low | Medium | Use SendGrid, monitor bounce rates |
| Feature flag complexity | Medium | Low | Start simple, expand gradually |
| Thanksgiving slowdown | High | Low | Buffer in Week 4 |

---

## ðŸ“š Documentation Needed

- [ ] Usage Dashboard guide
- [ ] Plan comparison page
- [ ] Upgrade flow documentation
- [ ] Feature toggle reference
- [ ] Alert configuration guide
- [ ] Whop integration setup

---

## ðŸ”— Links

- **Roadmap**: [ROADMAP_v2.1.4_to_v3.0.md](ROADMAP_v2.1.4_to_v3.0.md)
- **v2.1.4 Review**: [v2.1.4_COMPLETION_REVIEW.md](v2.1.4_COMPLETION_REVIEW.md)
- **GitHub Issues**: TBD (create #3-9)
- **Branch**: `v2.2.1-dev` (to be created)

---

## âœ… Definition of Done

v2.2.1 is ready to ship when:

### Features
- [ ] `/dashboard/usage` displays all metrics correctly
- [ ] Plan-based feature toggles working
- [ ] Usage alerts sending (email tested)
- [ ] Whop webhooks processing correctly
- [ ] Upgrade CTAs link to Whop portal

### Quality
- [ ] All tests passing (Python + MCP)
- [ ] New features have tests (>80% coverage)
- [ ] No breaking changes
- [ ] Dashboard mobile responsive
- [ ] No console errors

### Documentation
- [ ] User guide updated
- [ ] CHANGELOG.md updated
- [ ] Release notes written
- [ ] API documentation complete

### Business
- [ ] First paid conversion possible
- [ ] Revenue tracking working
- [ ] Analytics instrumented

---

**Last Updated**: November 13, 2025  
**Next Review**: End of Week 1 (Nov 17, 2025)
