# v2.1.7 Roadmap - AI-First Enhancements

**Target**: Early December 2025  
**Focus**: Memory management UX, smart features, agent-friendly improvements  
**Based on**: Real usage feedback from v2.1.6 dogfooding session

## Overview

v2.1.7 will enhance the memory management experience for AI agents and human users with smart automation, relationship tracking, and better memory lifecycle management.

**NEW: User Tier Framework** - Based on proven 10x token/speed gains, v2.1.7 introduces tier-aware configuration to serve all users from casual AI companions to regulated enterprises.

## User Tier Framework

WhiteMagic serves a spectrum of users with different needs:

| Tier | Users | Key Needs | Default Config |
|------|-------|-----------|----------------|
| **Casual** | Personal AI companions | "Remember my life", zero config | Light structure, strong privacy |
| **Power** | Devs, freelancers | Deep project understanding | Project spaces, persistent decisions |
| **Team** | Small orgs, startups | Shared team brain | Shared spaces, draft-review flows |
| **Regulated** | Medical, legal, gov | Help without leaks | Per-case isolation, audit trails |

**Core Principles** (all tiers):
1. **Memory Explicit**: Users know what's stored, why, where
2. **Three Layers**: Scratch (ephemeral) â†’ Working (active) â†’ Archive (long-term)
3. **AI-First, Human-Auditable**: Optimized for agents, reviewable by humans
4. **Spaces, Not Blobs**: Per-user/project/case isolation
5. **Human-in-the-Loop**: Critical actions require confirmation

## Priority 0: Interactive Setup Wizard (HIGH) - **ENHANCED**

**Problem**: New users face decision paralysis during installation  
**Solution**: Interactive setup wizard guides users through modular installation

### User Flow

```bash
$ pip install whitemagic
$ whitemagic setup

â•­â”€ WhiteMagic Setup Wizard (1/4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Welcome! How will you use WhiteMagic?             â”‚
â”‚                                                    â”‚
â”‚ [ ] Personal AI Companion                         â”‚
â”‚     Journaling, planning, creativity              â”‚
â”‚                                                    â”‚
â”‚ [ ] Development & Freelance Work                  â”‚
â”‚     Project memory, code context                  â”‚
â”‚                                                    â”‚
â”‚ [ ] Team Collaboration                            â”‚
â”‚     Shared knowledge, onboarding                  â”‚
â”‚                                                    â”‚
â”‚ [ ] Regulated Domain (Medical/Legal/Gov)          â”‚
â”‚     Per-case isolation, audit trails              â”‚
â”‚                                                    â”‚
â”‚ [Continue]                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â•­â”€ WhiteMagic Setup Wizard (2/4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ AI & Search Configuration                         â”‚
â”‚                                                    â”‚
â”‚ Current: Minimal (~50MB)                          â”‚
â”‚ âœ… Core memory, config, CLI                       â”‚
â”‚                                                    â”‚
â”‚ Add Local AI? (+2.5GB)                            â”‚
â”‚ [ ] Yes - Privacy-first, works offline           â”‚
â”‚ [ ] No - I'll use OpenAI API (requires key)      â”‚
â”‚                                                    â”‚
â”‚ [Continue] [Back]                                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

**Interactive Questions**:
1. **User Tier**: Personal / Dev / Team / Regulated
2. **Embeddings**: Local (privacy) or OpenAI (lightweight)?
3. **Model Download**: Install now or later?
4. **Initial Spaces**: Create project/case spaces?
5. **Memory Lifecycle**: Auto-archive settings?
6. **API Key** (if OpenAI): Set now or skip?

**Output**:
```bash
âœ“ Configuration saved to ~/.whitemagic/config.yaml
âœ“ Installing extras: whitemagic[embeddings]
âœ“ Downloading model: all-MiniLM-L6-v2 (88MB)
âœ“ Setup complete!

Next steps:
  $ whitemagic create --title "My first memory"
  $ whitemagic search-semantic "test query"
  $ whitemagic --help

Docs: https://github.com/lbailey94/whitemagic
```

### Implementation

```python
class SetupWizard:
    TIER_CONFIGS = {
        "personal": {
            "memory_retention": {"scratch": "1d", "working": "30d", "archive": "forever"},
            "auto_archive": False,
            "default_spaces": ["personal"],
        },
        "power": {
            "memory_retention": {"scratch": "1d", "working": "90d", "archive": "forever"},
            "auto_archive": True,
            "default_spaces": [],  # User creates project spaces
        },
        "team": {
            "memory_retention": {"scratch": "7d", "working": "180d", "archive": "forever"},
            "auto_archive": True,
            "default_spaces": ["shared"],
            "draft_review": True,
        },
        "regulated": {
            "memory_retention": {"scratch": "0d", "working": "as_needed", "archive": "forever"},
            "auto_archive": False,  # Manual only
            "default_spaces": [],  # Per-case isolation
            "audit_required": True,
            "strict_isolation": True,
        },
    }
    
    def run(self):
        """Interactive tier-aware setup wizard."""
        console = Console()
        
        # 1. Welcome & tier selection
        tier = self.ask_user_tier()  # personal / power / team / regulated
        tier_config = self.TIER_CONFIGS[tier]
        
        # 2. Check current installation
        current = self.check_installation()
        
        # 3. Ask about embeddings
        if not current.has_embeddings:
            choice = self.ask_embeddings()
            if choice == "local":
                self.install_extras(["embeddings"])
                self.download_model()
            elif choice == "openai":
                api_key = self.prompt_api_key()
                tier_config["embeddings"] = {"provider": "openai"}
        
        # 4. Create initial spaces (tier-specific)
        for space in tier_config["default_spaces"]:
            self.create_space(space)
        
        # 5. Save tier-aware configuration
        self.save_config({**tier_config, "user_tier": tier})
        
        # 6. Show tier-specific next steps
        self.show_next_steps(tier)
```

### CLI Commands
```bash
$ whitemagic setup           # Full interactive wizard
$ whitemagic setup --embeddings  # Just embeddings setup
$ whitemagic setup --reset   # Reset to defaults
$ whitemagic setup --show    # Show current setup
```

### Features
- **Tier Selection**: Personal / Power / Team / Regulated
- **Tier-Aware Defaults**: Memory retention, auto-archive, audit requirements
- **Space Creation**: Automatic initial spaces based on tier
- Detects current installation state
- Recommends options based on use case and tier
- Installs extras without re-running pip manually
- Creates configuration interactively
- Validates settings before saving
- Can re-run anytime to add features or change tier

**Benefit**: Removes friction from installation, guides users to right setup for their needs

---

## Priority 1: Memory Templates & Schemas (HIGH)

**Problem**: Inconsistent memory structure makes recall harder  
**Solution**: Standardized templates for common memory types

### Implementation

```yaml
# ~/.whitemagic/templates/architecture.yaml
type: long_term
tags_required:
  - architecture
  - component_name
suggested_tags:
  - design
  - patterns
  - security
fields:
  component_name: string (required)
  purpose: string (required)
  responsibilities: list (required)
  key_patterns: list
  integration_points: list
  security_considerations: list
```

### Features
- Built-in templates: architecture, testing, session, bug_report, decision
- Custom template creation via `wm template create`
- CLI: `wm create --template architecture`
- Template validation on memory creation
- Template marketplace (future: share community templates)

### Commands
```bash
$ wm template list
$ wm template show architecture
$ wm create --template architecture --title "Config System"
$ wm template create custom_template.yaml
```

**Benefit**: Consistent memory structure improves semantic search accuracy by 20-30%

---

## Priority 2: Auto-Tagging with LLM (HIGH)

**Problem**: Manual tagging is tedious and inconsistent  
**Solution**: LLM suggests tags based on content

### Implementation

```python
class AutoTagger:
    def suggest_tags(self, content: str, existing_tags: list) -> list:
        """Use LLM to suggest relevant tags."""
        prompt = f"""
        Analyze this memory content and suggest 3-5 relevant tags.
        Consider: technical concepts, project components, phase/version.
        Existing tags: {existing_tags}
        
        Content: {content[:500]}...
        
        Return only tag names, comma-separated.
        """
        suggested = llm.complete(prompt)
        return self._parse_tags(suggested)
```

### Features
- Auto-suggest on `wm create`
- Interactive: Show suggestions, user can accept/modify
- Learn from user corrections (feedback loop)
- Respect existing tag vocabulary (suggest from known tags first)
- Disable with `--no-auto-tag` flag

### UX Flow
```bash
$ wm create --title "Terminal Tool Fix"
Content: [paste]
Suggested tags: terminal, bugfix, v2.1.5, security
Accept? [Y/n/edit]: 
```

**Benefit**: Reduces friction, improves tag consistency across memories

---

## Priority 3: Memory Relationships & Graphs (MEDIUM)

**Problem**: Memories exist in isolation, connections are implicit  
**Solution**: Explicit relationship tracking

### Implementation

```yaml
# memory frontmatter
---
title: Terminal Tool Architecture
related_to:
  - terminal_tool_fixes.md:
      type: implements
      description: "Fixes based on this architecture"
  - testing_lessons.md:
      type: informed_by
      description: "Testing approach informed this design"
  - security_policy.md:
      type: depends_on
      description: "Security requirements"
---
```

### Relationship Types
- `depends_on`: This memory requires understanding of related memory
- `implements`: Related memory is an implementation of this design
- `supersedes`: This memory replaces/updates related memory
- `informed_by`: Related memory influenced this memory
- `related_to`: General connection

### Features
- `wm relate <memory1> <memory2> --type depends_on`
- `wm graph <memory>` - Show relationship graph (ASCII or rich tree)
- `wm graph --viz` - Export to Graphviz/Mermaid
- Auto-suggest relationships on create (LLM-based)
- Search traverses relationships (optional `--include-related`)

### Commands
```bash
$ wm relate terminal_arch.md terminal_fix.md --type implements
$ wm graph terminal_arch.md
terminal_arch.md
â”œâ”€â”€ implements â†’ terminal_fix.md
â”œâ”€â”€ informed_by â†’ testing_lessons.md
â””â”€â”€ depends_on â†’ security_policy.md

$ wm search-semantic "terminal" --include-related
# Returns direct matches + 1-hop related memories
```

**Benefit**: Makes implicit knowledge connections explicit, improves context retrieval

---

## Priority 4: Smart Memory Lifecycle (MEDIUM)

**Problem**: No automatic memory management, manual archival required  
**Solution**: Rule-based automatic archival and consolidation

### Implementation

```yaml
# ~/.whitemagic/config.yaml
memory_lifecycle:
  rules:
    - name: "Archive old sessions"
      pattern: "session_*"
      age_days: 7
      action: archive
      
    - name: "Archive version-specific docs"
      pattern: "*_v[0-9]*_*"
      age_days: 30
      action: archive
      
    - name: "Consolidate daily notes"
      pattern: "daily_*"
      age_days: 7
      action: suggest_consolidate
      target_pattern: "weekly_{year}_{week}.md"
```

### Features
- Run manually: `wm lifecycle check`
- Run on schedule: `wm lifecycle --daemon` (background process)
- Dry-run: `wm lifecycle check --dry-run`
- Interactive prompts before actions
- Consolidation suggestions (LLM-generated summaries)

### Example Output
```bash
$ wm lifecycle check
Found 5 memories matching lifecycle rules:

Archive (7 days old):
  - session_nov14_morning.md
  - session_nov14_evening.md
  
Consolidate suggestion (7 daily notes):
  - daily_nov08.md ... daily_nov14.md
  â†’ Suggested: weekly_2025_45.md
  
Proceed? [y/N]: 
```

**Benefit**: Keeps memory system clean, reduces search noise, automatic knowledge consolidation

---

## Priority 5: Memory Stats & Analytics (LOW)

**Problem**: No visibility into memory system usage and value  
**Solution**: Comprehensive statistics and insights

### Implementation

```python
class MemoryStats:
    def generate_report(self) -> dict:
        return {
            "total_memories": 156,
            "by_type": {"short_term": 45, "long_term": 111},
            "by_tag": {"architecture": 23, "testing": 18},
            "search_queries": 47,
            "token_efficiency": 0.947,  # vs checkpoints
            "most_accessed": ["terminal_arch.md", "config_system.md"],
            "growth_rate": "+12 memories/week",
            "consolidation_opportunities": 8,
        }
```

### Features
- `wm stats` - Overall statistics
- `wm stats --tag architecture` - Tag-specific stats
- `wm stats --period week` - Time-based analysis
- Export: `wm stats --export json/csv`
- Token efficiency metrics (compare to checkpoint baseline)

### Example Output
```bash
$ wm stats
â•­â”€ WhiteMagic Memory Statistics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Total Memories: 156                            â”‚
â”‚   Short-term: 45  â”‚  Long-term: 111           â”‚
â”‚                                                â”‚
â”‚ Most Used Tags:                                â”‚
â”‚   architecture (23)  testing (18)  v2.1.6 (12)â”‚
â”‚                                                â”‚
â”‚ Token Efficiency: 94.7% reduction             â”‚
â”‚   Checkpoint avg: 52k tokens                   â”‚
â”‚   WhiteMagic avg: 2.7k tokens                  â”‚
â”‚                                                â”‚
â”‚ Search Activity:                               â”‚
â”‚   47 queries this session                      â”‚
â”‚   Top terms: config, terminal, testing         â”‚
â”‚                                                â”‚
â”‚ Growth: +12 memories/week                      â”‚
â”‚ Consolidation opportunities: 8                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

**Benefit**: Validates WhiteMagic's value, identifies optimization opportunities

---

## Additional Nice-to-Haves

### Memory Diff/Version History
```bash
$ wm history terminal_arch.md
[Nov 14 8pm] Added Approver patterns (+150 lines)
[Nov 13 9pm] Added API integration (+80 lines)
[Nov 12 7pm] Initial architecture (created)

$ wm diff terminal_arch.md --between "Nov 13" "Nov 14"
```

### Batch Import/Export
```bash
$ wm export --tag v2.1.6 --format json > v2.1.6_memories.json
$ wm import memories.json --merge --dry-run
```

### Memory Compression (Long-term)
```yaml
compression:
  enabled: true
  age_days: 90
  mode: summary  # Store LLM summary + key facts
```

### Search Query Expansion
```python
# User: "config system"
# Expanded: ["config", "configuration", "pydantic", "settings", "yaml"]
```

---

## Security Review Followups (Nov 14, 2025)

Items identified in independent security reviews that should be addressed in v2.1.7:

### ðŸŸ¡ Medium Priority (v2.1.7)
- [ ] **#7: Semantic Search Caching** - Add disk cache for embeddings to prevent re-computation
- [ ] **#8: Security Documentation** - Add warnings about exec API to README/INSTALL
- [ ] **#9: Backup Hash Verification** - Compare hashes during restore for integrity
- [ ] **#10: Incremental Backups Implementation** - Implement manifest diffing for real incremental backups

### Implementation Strategy
These will be integrated into the weekly plan below, prioritizing #8 (docs) in Week 1, #7 (caching) in Week 2, and #9/#10 (backups) in Week 3.

---

## Implementation Plan

### Week 1: Setup Wizard + Security Docs + Templates
- [ ] **Setup Wizard** (Priority 0)
  - [ ] Detection of current installation state
  - [ ] Interactive prompts for embeddings choice
  - [ ] `pip install whitemagic[extras]` automation
  - [ ] Configuration file generation
  - [ ] CLI commands: `setup`, `setup --reset`, `setup --show`
  - [ ] Tests
- [ ] **Security Documentation** (#8 from review)
  - [ ] README warning about exec API
  - [ ] INSTALL security considerations
  - [ ] SECURITY.md threat model
- [ ] **Template Schema Design** (Priority 1)
  - [ ] Template YAML format
  - [ ] Built-in templates (architecture, testing, bug_report)
  - [ ] Template validation logic
  - [ ] Tests

### Week 2: Templates + Auto-Tagging + Caching
- [ ] **Template Implementation** (Priority 1 cont.)
  - [ ] CLI commands: `template list`, `template show`, `create --template`
  - [ ] Template marketplace structure
  - [ ] Documentation
  - [ ] Tests
- [ ] **Auto-Tagging** (Priority 2)
  - [ ] LLM integration for tag suggestion
  - [ ] Interactive tag acceptance/editing
  - [ ] Tag vocabulary learning
  - [ ] Tests
- [ ] **Semantic Search Caching** (#7 from review)
  - [ ] File-based embedding cache with mtime checking
  - [ ] Cache invalidation strategy
  - [ ] Performance benchmarks
  - [ ] Tests

### Week 3: Relationships + Lifecycle + Backups
- [ ] **Relationships** (Priority 3)
  - [ ] Relationship schema (YAML frontmatter)
  - [ ] Graph traversal logic
  - [ ] CLI commands: `relate`, `graph`
  - [ ] Rich visualization
  - [ ] Tests
- [ ] **Lifecycle Management** (Priority 4)
  - [ ] Rule-based archival engine
  - [ ] Consolidation suggestions
  - [ ] CLI commands
  - [ ] Tests
- [ ] **Backup Improvements** (#9, #10 from review)
  - [ ] Hash verification during restore
  - [ ] Incremental backup manifest diffing
  - [ ] Tests

### Week 4: Stats + Polish + Documentation
- [ ] **Stats & Analytics** (Priority 5)
  - [ ] Stats aggregation
  - [ ] Rich formatting
  - [ ] Export options
  - [ ] Tests
- [ ] **Polish & Release Prep**
  - [ ] Integration testing
  - [ ] Documentation updates
  - [ ] Migration guide
  - [ ] CHANGELOG preparation
  - [ ] Release prep

---

## Success Metrics

**Adoption**:
- 80% of new memories use templates
- Auto-tagging accepted 70%+ of the time

**Efficiency**:
- Memory search time reduced 30%
- Token usage reduced additional 10-15%

**Quality**:
- Tag consistency improved 40%
- Relationship-enhanced searches 25% better recall

**User Satisfaction**:
- "Creating memories is easier" - target 90%+
- "Finding memories is faster" - target 85%+

---

## Technical Considerations

### LLM Integration
- Use existing OpenAI client (already configured)
- Fallback to rule-based if API unavailable
- Cache suggestions to reduce API calls
- Configurable: `wm config-set ai.auto_tag_enabled true`

### Performance
- Graph traversal: Limit depth to 2-3 hops
- Stats: Cache calculations, refresh on demand
- Lifecycle: Run async, don't block operations

### Backwards Compatibility
- All features opt-in by default
- Existing memories work without changes
- Templates optional, not required
- Relationships added incrementally

---

## Questions for Discussion

1. **LLM Provider**: OpenAI only, or support local models too?
2. **Relationship UI**: ASCII tree, rich panels, or web-based graph?
3. **Auto-tagging**: Interactive prompt vs auto-apply with review?
4. **Lifecycle**: Daemon process vs manual runs vs on-demand?
5. **Stats Export**: Which formats priority? (JSON, CSV, HTML?)

---

## Next Steps

1. Create feature branch: `feature/v2.1.7-smart-memories`
2. Start with templates (highest ROI, clearest scope)
3. Dogfood on WhiteMagic development itself
4. Iterate based on real usage

**Estimated Timeline**: 3-4 weeks for v2.1.7 release  
**Target Date**: December 10-15, 2025
