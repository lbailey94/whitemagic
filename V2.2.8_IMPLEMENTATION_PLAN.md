# WhiteMagic v2.2.8 Implementation Plan

**Focus**: Stability, Automation, & AI-First UX  
**Timeline**: 1-2 weeks (Late Nov 2025)  
**Theme**: "Making it Even Easier"  
**Status**: Planning Phase

---

## ğŸ¯ Core Objectives

1. **Automation Tools** - Reduce manual maintenance
2. **AI Accessibility** - Make systems easier to discover/use
3. **Terminal-First** - Work without MCP dependency
4. **Stability** - Polish rough edges from v2.2.7

---

## ğŸ”¥ Priority 0 Features (Must Have)

### 1. `whitemagic audit` Command â­â­â­â­â­

**Purpose**: Automated project health check

**Implementation**:
```python
# whitemagic/cli_audit.py

def audit_project(full=False):
    results = {
        "version_sync": check_version_sync(),
        "doc_coverage": check_documentation(),
        "code_quality": check_code_quality(),
        "memory_stats": get_memory_stats(),
        "wu_xing_phase": detect_current_phase()
    }
    
    if full:
        results["dependencies"] = check_dependencies()
        results["security"] = run_security_checks()
    
    return format_audit_report(results)
```

**Output**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
WhiteMagic Project Audit v2.2.8
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Version Sync
   VERSION: 2.2.8
   pyproject.toml: 2.2.8
   MCP package.json: 2.2.8
   Python client: 2.2.8
   TS client: 2.2.8

âš ï¸  Documentation Drift (3 files)
   docs/USER_GUIDE.md: Line 42 shows "2.2.1"
   docs/INDEX.md: Line 67 shows "2.2.5"
   docs/CHEATSHEET.md: Line 12 shows "2.2.1"

âœ… Code Quality
   Test coverage: 87.3%
   Type hints: 94.1%
   TODOs: 3 (non-critical)

ğŸ“Š Memory Stats
   Short-term: 28 memories
   Long-term: 6 memories
   Consolidation recommended: 12 old memories

ğŸ¯ Wu Xing Status: FIRE (åŸ·è¡Œéšæ®µ)

Recommendations:
1. Run: whitemagic docs-check --fix
2. Review: 3 TODOs in codebase
3. Consider: whitemagic consolidate --auto
```

**Tests**: 
- Version sync detection
- Doc parsing
- Memory stats calculation
- Report formatting

**Estimate**: 4-6 hours

---

### 2. `whitemagic docs-check` Command â­â­â­â­â­

**Purpose**: Find and fix version drift in docs

**Implementation**:
```python
# whitemagic/cli_docs.py

def docs_check(fix=False):
    # Find all markdown files
    docs = find_markdown_files("docs/")
    
    # Scan for version references
    issues = []
    for doc in docs:
        issues.extend(scan_version_refs(doc))
    
    if fix:
        for issue in issues:
            apply_fix(issue)
    
    return issues
```

**Features**:
- Detect outdated version strings
- Find "pip install whitemagic==X.Y.Z" commands
- Check badge URLs
- Auto-fix with confirmation

**Example**:
```bash
whitemagic docs-check

Scanning documentation...
âœ“ README.md
âœ— USER_GUIDE.md - Found "2.2.1" (line 42)
âœ“ ARCHITECTURE.md
âœ— INDEX.md - Found "2.2.5" (line 67)

Fix these issues? [y/N] y

Updated 2 files.
Run 'git diff' to review changes.
```

**Tests**:
- Version detection
- File parsing
- Auto-fix logic
- Dry-run mode

**Estimate**: 3-4 hours

---

### 3. `whitemagic exec` Terminal Helper â­â­â­â­

**Purpose**: Batch command approval for AI agents

**Implementation**:
```python
# whitemagic/cli_exec.py

def exec_plan(commands_json, approval_mode='batch'):
    commands = parse_commands(commands_json)
    
    # Show all commands
    print_command_plan(commands)
    
    if approval_mode == 'batch':
        if confirm("Execute all commands?"):
            results = execute_all(commands)
    elif approval_mode == 'interactive':
        results = execute_interactive(commands)
    
    return results
```

**Usage**:
```bash
# From AI agent:
whitemagic exec plan << EOF
{
  "commands": [
    "git add -A",
    "git commit -m 'fix: version sync'",
    "git push origin main"
  ],
  "approval": "batch"
}
EOF

# Output:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Command Plan (3 commands)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. git add -A
2. git commit -m 'fix: version sync'
3. git push origin main

Execute all? [y/N] y

âœ“ Command 1: Success
âœ“ Command 2: Success
âœ“ Command 3: Success

All commands completed successfully.
```

**Security**:
- Whitelist safe commands
- Require confirmation for destructive ops
- Log all executions
- Rate limiting

**Tests**:
- Command parsing
- Execution logic
- Error handling
- Security checks

**Estimate**: 5-6 hours

---

### 4. `whitemagic version bump` Automation â­â­â­â­

**Purpose**: Sync version across all files

**Implementation**:
```bash
whitemagic version bump 2.2.9

Updates:
  âœ“ VERSION
  âœ“ pyproject.toml
  âœ“ whitemagic-mcp/package.json
  âœ“ clients/python/pyproject.toml
  âœ“ clients/typescript/package.json
  âœ“ whitemagic/parallel/__init__.py
  âœ“ CHANGELOG.md (adds entry)

Commit these changes? [y/N] y

[main abc123d] chore: bump version to 2.2.9
 7 files changed, 8 insertions(+), 8 deletions(-)
```

**Features**:
- Update all version references
- Add CHANGELOG entry
- Git commit automatically
- Validate version format

**Tests**:
- File updates
- CHANGELOG generation
- Git integration

**Estimate**: 2-3 hours

---

## â­ Priority 1 Features (Should Have)

### 5. Workflow Hints in Tool Responses

**Purpose**: Guide AI to use systems effectively

**Implementation**:
```typescript
// whitemagic-mcp/src/index.ts

function addWorkflowHints(result: any, toolName: string): any {
  const hints = {
    search_memories: "Consider parallel_search for multiple queries",
    create_memory: "Use batch_create_memories for multiple items",
    ...
  };
  
  return {
    ...result,
    meta: {
      hint: hints[toolName],
      wu_xing_phase: getCurrentPhase(),
      token_status: getTokenStatus()
    }
  };
}
```

**Tests**:
- Hint generation
- Phase detection
- Token tracking

**Estimate**: 3-4 hours

---

### 6. Auto-Context Loading on Session Start

**Purpose**: Reduce friction for AI agents

**Implementation**:
```python
# whitemagic-mcp auto-loads context

def on_session_start():
    context = mcp3_get_context(tier=1)
    rules = load_active_rules()
    
    return {
        "context": context,
        "rules": rules,
        "welcome": "WhiteMagic ready! Use parallel operations for speed."
    }
```

**Estimate**: 2-3 hours

---

### 7. Built-in Mini-Audits

**Purpose**: Automatic health checks every N tool calls

**Implementation**:
```python
# Track tool call count
tool_call_count = 0

def after_tool_call():
    global tool_call_count
    tool_call_count += 1
    
    if tool_call_count % 10 == 0:
        mini_audit = {
            "version_drift": check_quick(),
            "token_status": get_tokens(),
            "phase": get_phase()
        }
        
        if has_issues(mini_audit):
            suggest_fixes(mini_audit)
```

**Estimate**: 3-4 hours

---

## ğŸ¨ Priority 2 Features (Nice to Have)

### 8. Interactive Tutorial

```bash
whitemagic tutorial

WhiteMagic Interactive Tutorial
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Lesson 1: Tiered Context Loading
Try: whitemagic context --tier 1

[AI executes command]

Great! You loaded Tier 1 context (3K tokens vs 40K baseline).
This is the sweet spot for most tasks.

Next lesson: Parallel Operations
[Press Enter]
```

**Estimate**: 4-5 hours

---

### 9. Configuration Management

```bash
whitemagic config set default_tier 1
whitemagic config set auto_checkpoint true
whitemagic config set parallel_workers 64

whitemagic config show

Current Configuration:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
default_tier: 1
auto_checkpoint: true
parallel_workers: 64
wu_xing_tracking: true

Edit: ~/.whitemagic/config.yaml
```

**Estimate**: 2-3 hours

---

## ğŸ§ª Testing Strategy

### Unit Tests
```python
# tests/cli/test_audit.py
def test_version_sync_detection():
    assert detect_version_drift()

def test_audit_report_generation():
    report = generate_audit_report()
    assert "Version Sync" in report

# tests/cli/test_docs_check.py
def test_find_version_refs():
    refs = find_version_references("docs/")
    assert len(refs) > 0

# tests/cli/test_exec.py
def test_command_parsing():
    cmds = parse_commands('{"commands": [...]}')
    assert len(cmds) == 3
```

### Integration Tests
```python
# Test full workflows
def test_audit_to_fix_workflow():
    # Run audit
    audit = run_audit()
    
    # Find issues
    issues = audit['doc_drift']
    
    # Apply fixes
    fixed = docs_check_fix()
    
    # Verify
    audit2 = run_audit()
    assert len(audit2['doc_drift']) == 0
```

### Manual Testing
- Run all CLI commands
- Test terminal helper
- Verify AI Quickstart guide
- Check MCP integration

---

## ğŸ“š Documentation Updates

### New Guides
1. **CLI_AUTOMATION.md** - All automation tools
2. **TERMINAL_WORKFLOW.md** - Terminal-first usage
3. **AI_BEST_PRACTICES.md** - Expand AI Quickstart

### Updates
1. USER_GUIDE - Add automation commands
2. QUICKSTART - Mention terminal helper
3. CONTRIBUTING - Add testing guidelines

---

## ğŸ—“ï¸ Implementation Schedule

### Week 1 (Nov 18-24)
**Day 1-2**: `whitemagic audit` + `docs-check`
**Day 3-4**: `whitemagic exec` + version automation
**Day 5-6**: Workflow hints + auto-context
**Day 7**: Testing + bug fixes

### Week 2 (Nov 25-Dec 1)
**Day 1-2**: Mini-audits + config management
**Day 3-4**: Documentation updates
**Day 5**: Tutorial (if time)
**Day 6-7**: Testing, polish, release prep

---

## ğŸ¯ Success Metrics

### Automation
- Version drift: Auto-detected in <1 second
- Doc fixes: Auto-applied with 95%+ accuracy
- Command execution: Batch approval working

### AI Accessibility
- Context loading: Auto-loaded on session start
- Tool usage: Hints shown in responses
- Mini-audits: Running every 10 tool calls

### Terminal Experience
- All MCP tools have CLI equivalents
- Terminal helper working
- Configuration persisted

---

## ğŸš€ Release Criteria

### Code Complete
- [ ] All P0 features implemented
- [ ] All tests passing
- [ ] Documentation updated

### Quality
- [ ] Test coverage >85%
- [ ] No critical bugs
- [ ] Performance acceptable

### User Experience
- [ ] AI Quickstart validated
- [ ] Terminal helper tested
- [ ] Automation tools working

---

## ğŸ“¦ Deliverables

1. **4 new CLI commands**:
   - `whitemagic audit`
   - `whitemagic docs-check`
   - `whitemagic exec`
   - `whitemagic version bump`

2. **Enhanced MCP tools**:
   - Workflow hints
   - Auto-context loading
   - Mini-audits

3. **Documentation**:
   - 3 new guides
   - Updated existing docs
   - Enhanced AI Quickstart

4. **Testing**:
   - 20+ new tests
   - Integration test suite
   - Manual QA checklist

---

## ğŸ’¡ Ideas for v2.2.9

*(Deferred but worth tracking)*

1. **Parallel CLI** - `whitemagic parallel status/run`
2. **Terrain CLI** - `whitemagic terrain assess`
3. **Live TUI Dashboard** - Real-time monitoring
4. **Symbolic Explorer** - `whitemagic symbol æœ¨`
5. **Auto-learning** - AI learns from usage patterns

---

**Ready to implement v2.2.8!** ğŸš€

**Estimated total**: 30-40 hours (1-2 weeks)  
**Risk level**: Low (builds on stable v2.2.7)  
**Value**: High (major UX improvements)
