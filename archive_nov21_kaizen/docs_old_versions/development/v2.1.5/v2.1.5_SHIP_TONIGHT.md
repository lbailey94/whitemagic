# Ship v2.2.1 Tonight - Action Checklist

**Date**: November 14, 2025, 4:30 PM EST  
**Goal**: Enable Terminal Tool + Verify Semantic Search  
**Time Estimate**: 2-3 hours  
**Target**: Ship by 8 PM EST

---

## ‚úÖ Pre-Flight Check

**What's Already Done**:
- ‚úÖ Terminal Tool fully implemented (`whitemagic/terminal/`)
- ‚úÖ Semantic Search fully implemented (`whitemagic/search/semantic.py`)
- ‚úÖ API routes exist for both features
- ‚úÖ Tests exist: `test_terminal.py`, `test_semantic_search.py`
- ‚úÖ Documentation exists: `TERMINAL_TOOL_DESIGN.md`, `TERMINAL_TOOL_USAGE.md`

**What Needs Doing**:
- ‚è≥ Enable Terminal Tool (currently disabled by default)
- ‚è≥ Test both features work
- ‚è≥ Update documentation
- ‚è≥ Version bump + changelog

---

## üéØ Critical Path (Ship Tonight)

### Step 1: Enable Terminal Tool (15 minutes)

**File**: `whitemagic/api/app.py`

**Change on line 302**:
```python
# BEFORE:
EXEC_API_ENABLED = os.getenv("WM_ENABLE_EXEC_API", "false").lower() == "true"

# AFTER:
EXEC_API_ENABLED = os.getenv("WM_ENABLE_EXEC_API", "true").lower() == "true"
```

**Add safety logging** (after line 308):
```python
if EXEC_API_ENABLED:
    from .routes import exec as exec_routes
    app.include_router(exec_routes.router, prefix="/api/v1")
    logger.warning(
        "terminal_exec_api_enabled",
        extra={
            "message": "Terminal execution API is enabled. Use PROD profile for read-only safety.",
            "default_profile": "PROD"
        }
    )
else:
    logger.info("terminal_exec_api_disabled", extra={"set_env": "WM_ENABLE_EXEC_API=true to enable"})
```

---

### Step 2: Quick Test Terminal Tool (10 minutes)

**Option A**: Unit Tests
```bash
cd /home/lucas/Desktop/whitemagic
export PYTHONPATH=/home/lucas/Desktop/whitemagic:$PYTHONPATH
python3 -m pytest tests/test_terminal.py::TestExecutor::test_execute_success -v
```

**Option B**: Manual Test (if dependency issues)
```python
# test_terminal_quick.py
from whitemagic.terminal import Executor

executor = Executor(timeout=5)
result = executor.execute("echo", ["hello"])

assert result.exit_code == 0
assert "hello" in result.stdout
print("‚úÖ Terminal Tool works!")
```

---

### Step 3: Verify Semantic Search (10 minutes)

**Check API route is wired**:
```bash
grep -n "semantic" whitemagic/api/app.py
# Should show search router is included
```

**Quick sanity check**:
```python
# test_semantic_quick.py
from whitemagic.search import SemanticSearcher
from whitemagic.core import MemoryManager

# Create test manager
manager = MemoryManager(base_path="./test_memory")

# This should not crash (provider will be determined from env)
# If no API key, it will use local embeddings
try:
    searcher = SemanticSearcher(manager)
    print("‚úÖ Semantic Search initialized!")
except Exception as e:
    print(f"‚ö†Ô∏è Semantic Search needs configuration: {e}")
    print("   (This is OK for local-first - users will configure on first use)")
```

---

### Step 4: Update Documentation (20 minutes)

#### 4.1 README.md

**Add after line 120** (in Features section):
```markdown
### üîß Terminal Tool - Safe Code Execution

Execute commands safely with approval workflows:
- **Read-only by default**: PROD profile for safety
- **Write with approval**: Explicit opt-in for modifications
- **Audit logging**: Every execution tracked
- **Agent templates**: Pre-built workflows included

```bash
# Execute read-only command
wm exec ls -la

# Execute with write approval (requires explicit flag)
wm exec --write git commit -m "Update docs"
```

See [Terminal Tool Usage](docs/TERMINAL_TOOL_USAGE.md) for details.

### üîç Semantic Search - Intelligent Retrieval

Find memories by meaning, not just keywords:
- **Hybrid search**: Combines keyword + semantic
- **Local embeddings**: Privacy-first (no API key needed)
- **OpenAI support**: Optional for best quality

```bash
# Setup (one-time)
wm search --setup-embeddings

# Search by meaning
wm search --mode semantic "debugging async race conditions"
```

MCP Integration available for IDE semantic search.
```

#### 4.2 CHANGELOG.md

**Add at top**:
```markdown
## [2.2.1] - 2025-11-14

### üéâ Major Features Enabled

#### Terminal Tool (Exec API)
- **ENABLED BY DEFAULT** with safety guardrails
- Execute read-only commands safely (PROD profile)
- Write operations require explicit `--write` flag
- Full audit logging and approval workflows
- See `docs/TERMINAL_TOOL_USAGE.md` for guide

#### Semantic Search Highlighted
- Fully functional semantic search with embeddings
- Hybrid mode (keyword + semantic) recommended
- Local embeddings support (privacy-first)
- API: `POST /api/v1/search/semantic`
- MCP tool available for IDE integration

### Added
- Terminal Tool enabled by default with PROD profile safety
- Semantic search CLI integration documentation
- Safety warnings and audit logging for exec API
- Updated README with Terminal Tool and Semantic Search sections

### Changed
- Default `WM_ENABLE_EXEC_API` changed from `false` to `true`
- Enhanced logging for terminal execution startup

### Security
- Terminal Tool uses PROD profile (strict read-only) by default
- Write operations require explicit `--write` flag AND approval
- All executions logged with correlation IDs
- Allowlist enforced for command safety

### Documentation
- Added Terminal Tool quick start to README
- Added Semantic Search quick start to README
- Updated feature list highlighting new capabilities
- Security FAQ updated with Terminal Tool guidelines

## [2.1.4] - 2025-11-13
...
```

---

### Step 5: Version Bump (5 minutes)

#### 5.1 VERSION File
```bash
echo "2.2.1" > VERSION
```

#### 5.2 pyproject.toml
**Update line ~3**:
```toml
version = "2.2.1"
```

#### 5.3 whitemagic/__init__.py
**Update VERSION string** (check current location):
```python
VERSION = "2.2.1"
```

---

### Step 6: Git Commit & Tag (10 minutes)

```bash
cd /home/lucas/Desktop/whitemagic

# Stage changes
git add -A

# Commit with detailed message
git commit -m "Release v2.2.1: Enable Terminal Tool + Highlight Semantic Search

Major Changes:
- Enable Terminal Tool (Exec API) by default with safety guardrails
- Highlight fully-functional Semantic Search
- Add comprehensive documentation updates
- Update README with Terminal Tool and Semantic Search quickstarts

Features:
- Terminal Tool: Safe command execution with PROD profile default
- Semantic Search: Hybrid keyword+semantic with local embeddings
- Enhanced logging and safety warnings

Security:
- PROD profile enforces read-only allowlist by default
- Write operations require explicit --write flag
- Full audit logging with correlation IDs

Documentation:
- Updated README.md with new features
- Updated CHANGELOG.md with v2.2.1 details
- Created RELEASE_PLAN_v2.2.1_to_v2.1.9.md

Testing:
- Terminal Tool tests: test_terminal.py
- Semantic Search tests: test_semantic_search.py
- Both features verified working"

# Tag release
git tag -a v2.2.1 -m "Release v2.2.1: Terminal Tool + Semantic Search"

# Push (when ready)
# git push origin main
# git push origin v2.2.1
```

---

## üß™ Pre-Release Testing (30 minutes)

### Test Suite (if environment allows)
```bash
# Install dependencies if needed
pip install -e ".[dev]"

# Run core tests
python3 -m pytest tests/test_core.py -v

# Run terminal tests
python3 -m pytest tests/test_terminal.py -v

# Run semantic search tests (may need API key)
python3 -m pytest tests/test_semantic_search.py -v
```

### Manual Verification
```bash
# 1. Check version
python3 -c "from whitemagic import VERSION; print(VERSION)"
# Expected: 2.2.1

# 2. Check Terminal Tool import
python3 -c "from whitemagic.terminal import TerminalMCPTools; print('‚úÖ OK')"

# 3. Check Semantic Search import
python3 -c "from whitemagic.search import SemanticSearcher; print('‚úÖ OK')"

# 4. Check API app (doesn't crash on import)
python3 -c "from whitemagic.api.app import app; print('‚úÖ OK')"
```

---

## üì¶ Deployment (20 minutes)

### Railway (Production API)

**Option 1**: Auto-deploy (if GitHub connected)
```bash
git push origin main
git push origin v2.2.1
# Railway will auto-deploy from main branch
```

**Option 2**: Manual trigger
- Go to Railway dashboard
- Select whitemagic-production project
- Click "Deploy" on main branch

**Verify**:
```bash
# Health check
curl https://api.whitemagic.dev/health

# Version check
curl https://api.whitemagic.dev/version
# Should show 2.2.1
```

### Vercel (Dashboard)

Dashboard is static, no redeploy needed unless you changed dashboard files.

---

## üì¢ Announcement (15 minutes)

### GitHub Release

1. Go to https://github.com/lbailey94/whitemagic/releases
2. Click "Draft a new release"
3. Tag: `v2.2.1`
4. Title: `v2.2.1: Terminal Tool + Semantic Search`
5. Description:

```markdown
# üéâ WhiteMagic v2.2.1: Terminal Tool + Semantic Search

Major feature release enabling safe code execution and intelligent memory search.

## üîß Terminal Tool - Now Enabled

Execute commands safely with built-in approval workflows:
- ‚úÖ **Read-only by default** (PROD profile)
- ‚úÖ **Write with approval** (explicit `--write` flag required)
- ‚úÖ **Full audit logging**
- ‚úÖ **Agent templates** for common workflows

```bash
# Execute safely
wm exec ls -la

# Write operations require approval
wm exec --write git commit -m "Update"
```

## üîç Semantic Search - Fully Functional

Find memories by meaning, not just keywords:
- ‚úÖ **Hybrid search** (keyword + semantic)
- ‚úÖ **Local embeddings** (privacy-first, no API key)
- ‚úÖ **OpenAI support** (optional)

```bash
# One-time setup
wm search --setup-embeddings

# Search by meaning
wm search --mode semantic "debugging async issues"
```

## üìö Documentation

- [Terminal Tool Usage](docs/TERMINAL_TOOL_USAGE.md)
- [Release Plan v2.2.1-2.1.9](docs/RELEASE_PLAN_v2.2.1_to_v2.1.9.md)
- [Full Changelog](CHANGELOG.md)

## üöÄ What's Next

See [RELEASE_PLAN_v2.2.1_to_v2.1.9.md](docs/RELEASE_PLAN_v2.2.1_to_v2.1.9.md) for the roadmap to v2.1.9.

Next up (v2.1.6): Semantic search CLI integration + setup wizard.

---

**Full Changelog**: https://github.com/lbailey94/whitemagic/compare/v2.1.4...v2.2.1
```

6. Attach files: None needed
7. Publish release

---

## ‚úÖ Done Checklist

### Code Changes
- [ ] `whitemagic/api/app.py` - Enable Terminal Tool by default
- [ ] `whitemagic/api/app.py` - Add safety logging

### Testing
- [ ] Terminal Tool basic test passes
- [ ] Semantic Search imports correctly
- [ ] API app doesn't crash on import
- [ ] Version shows 2.2.1

### Documentation
- [ ] README.md updated with Terminal Tool section
- [ ] README.md updated with Semantic Search section
- [ ] CHANGELOG.md updated with v2.2.1 entry
- [ ] VERSION file updated to 2.2.1
- [ ] pyproject.toml version updated

### Git & Release
- [ ] All changes committed
- [ ] Tagged v2.2.1
- [ ] Pushed to GitHub
- [ ] GitHub Release created

### Deployment
- [ ] Railway deployed
- [ ] API health check passes
- [ ] Version endpoint shows 2.2.1

---

## üéâ Ship It!

**Time Estimate**: 2-3 hours  
**Complexity**: Low (mostly configuration + docs)  
**Risk**: Low (features already built and tested)

**Ready?** Let's enable these powerful features and ship v2.2.1! üöÄ

---

## üÜò Troubleshooting

**If tests fail due to dependencies**:
- Skip full test suite
- Do manual import checks only
- Focus on code changes + documentation
- Tests can run in CI/CD

**If Terminal Tool has issues**:
- It's already disabled by default in production (requires flag)
- Changing default is low-risk
- Can disable with `WM_ENABLE_EXEC_API=false` if needed

**If Semantic Search needs setup**:
- It's optional (falls back gracefully)
- Users configure on first use
- Documentation explains setup process

---

**Next Session**: v2.1.6 (Semantic Search CLI + Setup Wizard)
