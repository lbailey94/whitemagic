# v2.2.2 Implementation Plan

**Target**: Late November 2025  
**Type**: Minor release (new features, backwards compatible)  
**Focus**: MCP optimization, parallel contexts, incremental backups

---

## Implementation Tracking

### Feature 1: MCP Optimization Mode ⏳
**Priority**: Critical (highest ROI - 5-10x speed improvement)  
**Effort**: 1-2 days  
**Status**: Starting now

- [ ] Phase 1A: Add fast_mode parameter to MCP tools
- [ ] Phase 1B: Implement batch read operations
- [ ] Phase 1C: Add caching layer with LRU
- [ ] Phase 1D: Lazy metadata loading
- [ ] Phase 1E: Update MCP server (TypeScript)
- [ ] Phase 1F: Update Python client
- [ ] Phase 1G: Add benchmarks
- [ ] Phase 1H: Documentation

### Feature 2: Parallel Memory Contexts
**Priority**: High (enables new workflows)  
**Effort**: 2-3 days  
**Status**: Not started

- [ ] Phase 2A: Add --memory-dir CLI flag
- [ ] Phase 2B: Environment variable support
- [ ] Phase 2C: File locking for writes
- [ ] Phase 2D: Separate SQLite per context
- [ ] Phase 2E: Background operations support
- [ ] Phase 2F: Documentation & examples

### Feature 3: Incremental Backups
**Priority**: High (user-requested)  
**Effort**: 1 day  
**Status**: Not started

- [ ] Phase 3A: Manifest format design
- [ ] Phase 3B: Change detection logic
- [ ] Phase 3C: Backup chaining (base + incremental)
- [ ] Phase 3D: Restore from chain
- [ ] Phase 3E: Automatic cleanup of old backups
- [ ] Phase 3F: Tests & documentation

### Feature 4: External Memory Integration
**Priority**: Medium  
**Effort**: 2-3 days  
**Status**: Deferred to later in v2.2.2

- [ ] Phase 4A: Unified search across memory + docs
- [ ] Phase 4B: External file indexing
- [ ] Phase 4C: Cross-referencing system
- [ ] Phase 4D: Documentation

### Feature 5: Memory Analytics
**Priority**: Low (nice to have)  
**Effort**: 3-4 days  
**Status**: Deferred to v2.3.0

### Feature 6: Smart Consolidation
**Priority**: Low (polish feature)  
**Effort**: 2-3 days  
**Status**: Deferred to v2.3.0

---

## Current Session Plan

**Token budget**: 108K remaining (54%)  
**Stop if**: Below 20% (40K tokens)

### Today's Goals (Features 1-3)
1. ✅ Planning phase complete
2. ⏳ MCP optimization implementation
3. ⏳ Parallel contexts implementation  
4. ⏳ Incremental backups implementation
5. ⏳ Testing & verification
6. ⏳ Documentation updates

---

## Files to Create/Modify

### MCP Optimization
- `whitemagic-mcp/src/optimizations.ts` (new)
- `whitemagic-mcp/src/cache.ts` (new)
- `whitemagic-mcp/src/index.ts` (modify - add fast mode)
- `whitemagic/mcp_client.py` (modify - add batch ops)

### Parallel Contexts
- `whitemagic/cli_app.py` (modify - add --memory-dir flag)
- `whitemagic/core.py` (modify - support custom paths)
- `whitemagic/config/manager.py` (modify - per-context config)

### Incremental Backups
- `whitemagic/backup.py` (modify - add incremental logic)
- `whitemagic/manifest.py` (new - manifest handling)

---

## Testing Strategy

### Unit Tests
- MCP fast mode performance
- Batch operations correctness
- Cache hit/miss rates
- Parallel context isolation
- Incremental backup restore

### Integration Tests
- End-to-end MCP optimization
- Multi-context workflows
- Backup/restore cycles

### Benchmarks
- MCP read speed (fast vs normal)
- Batch vs serial operations
- Incremental vs full backup

---

## Token Budget Tracking

**Phase 1A (MCP fast mode)**: Est. 5-8K tokens  
**Phase 1B (Batch ops)**: Est. 5-8K tokens  
**Phase 1C (Caching)**: Est. 5-8K tokens  
**Phase 2A-D (Parallel contexts)**: Est. 15-20K tokens  
**Phase 3A-F (Incremental backups)**: Est. 10-15K tokens

**Total estimated**: 40-59K tokens  
**Buffer for adjustments**: 20K tokens  
**Safety margin**: 30K tokens

**Should complete all 3 features comfortably** ✅

---

**Status**: ✅ Planning complete, ready to implement  
**Next**: Start Feature 1 (MCP Optimization)
